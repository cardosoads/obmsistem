<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Corre√ß√£o FIPE</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: white;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            border: 1px solid #1E3951;
        }
        .test-field {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #1E3951;
            border-radius: 5px;
        }
        .test-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .test-field input {
            width: 100%;
            padding: 10px;
            border: 1px solid #1E3951;
            border-radius: 4px;
            font-size: 16px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background-color: white;
            border: 1px solid #1E3951;
            border-radius: 4px;
            font-weight: bold;
            color: #1E3951;
        }
        .error {
            background-color: white;
            color: #1E3951;
            border-color: #F8AB14;
        }
        .success {
            background-color: white;
            color: #1E3951;
            border-color: #F8AB14;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Teste de Corre√ß√£o - Formata√ß√£o FIPE</h1>
        <p>Este teste simula o problema onde "10.000,00" aparecia como "1.000,000"</p>
        
        <div class="test-field">
            <label for="fipe">Campo FIPE (com m√°scara monet√°ria):</label>
            <input type="text" id="fipe" class="money-mask" placeholder="Digite um valor">
            <div class="result" id="resultado-fipe">Resultado aparecer√° aqui...</div>
        </div>
        
        <div class="test-field">
            <label>Testes Espec√≠ficos:</label>
            <button onclick="testarProblemaReportado()">üîç Testar Problema: '1' ‚Üí '0,01'</button>
            <button onclick="testarValor('10000')">Testar: 10.000,00</button>
            <button onclick="testarValor('100000')">Testar: 100.000,00</button>
            <button onclick="testarValor('123456')">Testar: 1.234,56</button>
            <button onclick="testarValor('1111111111')" style="background-color: #F8AB14; color: white; border: none; padding: 8px 15px; border-radius: 4px; margin: 5px; cursor: pointer;">üö® Teste 1: 11.111.111,11</button>
            <button onclick="testarValor('123456789')" style="background-color: #F8AB14; color: white; border: none; padding: 8px 15px; border-radius: 4px; margin: 5px; cursor: pointer;">üö® Teste 2: 1.234.567,89</button>
            <div class="result" id="resultado-teste">Clique em um bot√£o para testar</div>
        </div>
    </div>

    <script src="js/money-mask.js"></script>
    
    <script>
        // Fun√ß√£o corrigida para formatar FIPE (igual √† implementada nos arquivos)
        function formatFipeValue() {
            const fipeField = document.getElementById('fipe');
            if (fipeField && fipeField.value) {
                const fipeValue = fipeField.value.trim();
                if (fipeValue && fipeValue !== '0,00' && fipeValue !== '') {
                    // Se j√° tem R$ no in√≠cio, retorna como est√°
                    if (fipeValue.startsWith('R$')) {
                        return fipeValue;
                    }
                    // Se n√£o tem R$, adiciona sem alterar o resto
                    return 'R$ ' + fipeValue;
                }
            }
            return 'R$ 0,00';
        }
        
        // Fun√ß√£o para verificar se brazilian-values est√° funcionando
        function checkBrazilianValues() {
            const brazilianLib = typeof window !== 'undefined' ? window.BrazilianValues : null;
            if (brazilianLib && brazilianLib.formatToBRL) {
                console.log('‚úÖ Brazilian Values dispon√≠vel!');
                console.log('Teste: formatToBRL(1234.56) =', brazilianLib.formatToBRL(1234.56));
                return true;
            } else {
                console.log('‚ö†Ô∏è Brazilian Values n√£o dispon√≠vel, usando fallback');
                return false;
            }
        }
        
        // Fun√ß√£o antiga (problem√°tica) para compara√ß√£o
        function formatFipeValueOld(formValue) {
            const fipeValue = formValue || '0,00';
            if (fipeValue.startsWith('R$')) {
                return fipeValue;
            }
            return 'R$ ' + fipeValue;
        }
        
        // Atualizar resultado em tempo real
        document.getElementById('fipe').addEventListener('input', function() {
            const resultadoDiv = document.getElementById('resultado-fipe');
            const valorFormatado = formatFipeValue();
            
            resultadoDiv.innerHTML = `
                <strong>Valor Formatado (NOVO):</strong> ${valorFormatado}<br>
                <strong>Valor do Campo:</strong> "${this.value}"<br>
                <strong>Valor Num√©rico:</strong> ${window.getFieldNumericValue ? window.getFieldNumericValue('fipe') : 'N/A'}
            `;
            
            // Verificar se est√° correto
            if (this.value === '10.000,00' && valorFormatado === 'R$ 10.000,00') {
                resultadoDiv.className = 'result success';
            } else if (this.value && !valorFormatado.includes(this.value)) {
                resultadoDiv.className = 'result error';
            } else {
                resultadoDiv.className = 'result';
            }
        });
        
        // Fun√ß√£o para testar valores espec√≠ficos
        function testarValor(valor) {
            const fipeField = document.getElementById('fipe');
            const resultadoDiv = document.getElementById('resultado-teste');
            
            // Simular digita√ß√£o
            fipeField.value = '';
            fipeField.focus();
            
            // Simular digita√ß√£o caractere por caractere
            for (let i = 0; i < valor.length; i++) {
                fipeField.value += valor[i];
                // Aplicar m√°scara
                if (window.applyMoneyMask) {
                    window.applyMoneyMask(fipeField);
                }
                fipeField.dispatchEvent(new Event('input'));
            }
            
            // Aguardar um momento e verificar resultado
            setTimeout(() => {
                const valorFinal = fipeField.value;
                const valorFormatado = formatFipeValue();
                const valorOld = formatFipeValueOld(valorFinal);
                
                resultadoDiv.innerHTML = `
                    <strong>Valor Digitado:</strong> ${valor}<br>
                    <strong>Valor no Campo:</strong> "${valorFinal}"<br>
                    <strong>Formata√ß√£o NOVA:</strong> ${valorFormatado}<br>
                    <strong>Formata√ß√£o ANTIGA:</strong> ${valorOld}<br>
                    <strong>Status:</strong> ${valorFormatado.includes(valorFinal) ? '‚úÖ CORRETO' : '‚ùå INCORRETO'}
                `;
                
                if (valorFormatado.includes(valorFinal)) {
                    resultadoDiv.className = 'result success';
                } else {
                    resultadoDiv.className = 'result error';
                }
            }, 100);
        }
        
        // Teste espec√≠fico para o problema reportado
        function testarProblemaReportado() {
            const fipeField = document.getElementById('fipe');
            const resultadoDiv = document.getElementById('resultado-fipe');
            
            // Limpar campo
            fipeField.value = '';
            fipeField.focus();
            
            // Simular digita√ß√£o de '1'
            fipeField.value = '1';
            fipeField.dispatchEvent(new Event('input'));
            
            setTimeout(() => {
                const valorFinal = fipeField.value;
                const valorFormatado = formatFipeValue();
                
                resultadoDiv.innerHTML = `
                    <h3>üîç Teste do Problema Reportado</h3>
                    <p><strong>Digitado:</strong> "1"</p>
                    <p><strong>Valor no Campo:</strong> "${valorFinal}"</p>
                    <p><strong>Valor Formatado:</strong> ${valorFormatado}</p>
                    <p><strong>Esperado:</strong> "0,01" no campo e "R$ 0,01" formatado</p>
                    <p><strong>Status:</strong> ${valorFinal === '0,01' && valorFormatado === 'R$ 0,01' ? '‚úÖ CORRETO' : '‚ùå INCORRETO'}</p>
                `;
                
                if (valorFinal === '0,01' && valorFormatado === 'R$ 0,01') {
                    resultadoDiv.className = 'result success';
                } else {
                    resultadoDiv.className = 'result error';
                }
            }, 100);
        }
        
        // Teste autom√°tico quando a p√°gina carrega
        window.addEventListener('load', function() {
            setTimeout(() => {
                console.log('Testando corre√ß√£o FIPE...');
                checkBrazilianValues();
                testarValor('10000');
            }, 2000); // Aumentado para 2 segundos para dar tempo da biblioteca carregar
        });
    </script>
</body>
</html>